<!DOCTYPE html>
<html>
<head>
    <title>Leitor de Código de Barras</title>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/gh/andrastoth/webcodecamjs/js/qrcodelib.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/andrastoth/webcodecamjs/js/webcodecamjs.js"></script>
    <style>
        #barcode-scanner {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            position: relative;
        }
        #guides {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
            font-weight: bold;
            font-size: 20px;
            color: #333;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            border: 2px solid #f00; /* Cor vermelha */
            pointer-events: none; /* Permitir que cliques passem através do overlay */
        }
    </style>
</head>
<body>
    <h1>Leitor de Código de Barras</h1>
    <button onclick="startScanner()" id="start-button">Iniciar</button>
    <div id="barcode-scanner">
        <video id="barcode-video"></video>
        <div id="overlay"></div>
        <div id="guides">Posicione o código de barras dentro da área</div>
    </div>
    <script>
        let txt = "innerText" in HTMLElement.prototype ? "innerText" : "textContent";
        let arg = {
            resultFunction: function(result) {
                document.getElementById('barcode-result').textContent = result.code;
                // Emitir um som de bipe aqui
                var audio = new Audio('https://www.soundjay.com/button/beep-07.wav');
                audio.play();
            }
        };
        function startScanner() {
            let video = document.getElementById('barcode-video');
            navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
            .then(function(stream) {
                video.srcObject = stream;
                video.play();
                document.getElementById('start-button').style.display = "none";
                document.getElementById('guides').style.display = "none";
                document.getElementById('overlay').style.display = "block";
            })
            .catch(function(error) {
                console.log("Erro ao acessar a câmera: " + error);
            });
            let decoder = new WebCodeCamJS("#barcode-video").buildSelectMenu("select", "environment|back").init(arg).play();
            decoder.options.zoom = 1;
            decoder.options.contrast = 100;
            decoder.options.brightness = 0;
            decoder.options.hue = 0;
            decoder.options.saturation = 0;
            decoder.options.sharpness = 0;
            decoder.options.inputStream.constraints = {
                video: {
                    width: { ideal: 4096 },
                    height: { ideal: 2160 },
                    facingMode: "environment"
                }
            };
        }
    </script>
    <div id="result" style="display: none;">
        <h2>Resultado:</h2>
        <p id="barcode-result"></p>
    </div>
</body>
</html>
